import{r as a,j as e,H as E,L as p}from"./app-3oxT7Qwb.js";import{B as d}from"./createLucideIcon-CAa-BiGa.js";import{R as F}from"./refresh-cw-LwlnI8_b.js";import{S as O}from"./shopping-bag-AOXzlYCp.js";import{L as S}from"./loader-circle-CCeALjpz.js";import{P}from"./package-BGVNTpof.js";import{M as L}from"./map-pin-DndmTP3_.js";import{E as D}from"./external-link-9bZhsU8y.js";import{A as R}from"./arrow-right-Cqh62aOo.js";/* empty css            */function y(){return typeof window>"u"?null:window.Telegram?.WebApp??null}function N(){if(typeof window>"u")return null;const t=m=>{const u=m.trim().replace(/^[?#]/,"");if(u==="")return null;const o=new URLSearchParams(u).get("tgWebAppData");if(typeof o!="string")return null;const i=o.trim();return i===""?null:i};return t(window.location.search)??t(window.location.hash)}function H(t){return t==="preparing"?"Preparing":t==="ready"?"Ready for Pickup":t==="completed"?"Completed":"Pending"}function B(t){return t==="completed"?"bg-emerald-100 text-emerald-700":t==="ready"?"bg-blue-100 text-blue-700":t==="preparing"?"bg-amber-100 text-amber-700":"bg-zinc-100 text-zinc-700"}function M(t){return new Intl.NumberFormat("en-ET",{style:"currency",currency:"ETB",maximumFractionDigits:2}).format(t)}function X({scope:t}){const[m,u]=a.useState([]),[n,o]=a.useState(!0),[i,h]=a.useState(null),[v,w]=a.useState(0),[k,z]=a.useState(0),[C,_]=a.useState(0),g=t==="history"?"Telegram Order History":"Active Telegram Orders",A=a.useMemo(()=>t==="history"?"All orders you placed through Telegram.":"Orders currently pending, preparing, or ready for pickup.",[t]);return a.useEffect(()=>{let r=!1,f=null,l=null;const T=async c=>{o(!0),h(null),f=new AbortController;try{const x=await fetch("/api/telegram/miniapp/orders",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({init_data:c,scope:t}),signal:f.signal}),s=await x.json();if(!x.ok||!s.ok)throw new Error(s.error??"Unable to load Telegram orders.");if(r)return;u(Array.isArray(s.orders)?s.orders:[]),z(Number(s.meta?.active_orders_count??0)),_(Number(s.meta?.history_orders_count??0))}catch{r||(u([]),h("Could not load Telegram orders. Please open this page from the Telegram bot and try again."))}finally{r||o(!1)}},b=c=>{if(r)return;c?.ready?.(),c?.expand?.();const x=typeof c?.initData=="string"?c.initData.trim():"",s=x!==""?x:N()??"";if(s===""){o(!1),h("Telegram session data is missing. Open this from /track or /history in the bot.");return}T(s)},j=y();return j!==null||N()!==null?b(j):typeof document<"u"&&(l=document.createElement("script"),l.src="https://telegram.org/js/telegram-web-app.js",l.async=!0,l.onload=()=>{b(y())},document.head.appendChild(l)),()=>{r=!0,f?.abort(),l&&l.remove()}},[t,v]),e.jsxs(e.Fragment,{children:[e.jsx(E,{title:g}),e.jsx("div",{className:"min-h-screen bg-[#FAFAFA] text-[#212121]",children:e.jsxs("main",{className:"mx-auto w-full max-w-4xl px-4 py-8 md:px-8",children:[e.jsxs("div",{className:"mb-8 rounded-3xl bg-white p-6 shadow-lg ring-1 ring-zinc-100",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-[#9E9E9E]",children:"Telegram Miniapp"}),e.jsx("h1",{className:"mt-1 text-2xl font-black text-[#212121]",children:g}),e.jsx("p",{className:"mt-2 text-sm text-[#757575]",children:A})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{type:"button",variant:"outline",className:"h-10 rounded-xl border-zinc-200",onClick:()=>w(r=>r+1),disabled:n,children:[e.jsx(F,{className:`size-4 ${n?"animate-spin":""}`}),"Refresh"]}),e.jsx(d,{asChild:!0,className:"h-10 rounded-xl bg-[#F57C00] font-black hover:bg-[#E65100]",children:e.jsxs(p,{href:"/telegram/menu",children:[e.jsx(O,{className:"size-4"}),"Menu"]})})]})]}),e.jsxs("div",{className:"mt-5 flex flex-wrap items-center gap-3 text-xs font-bold text-[#616161]",children:[e.jsxs("span",{className:"rounded-full bg-[#FFF3E0] px-3 py-1 text-[#E65100]",children:["Active: ",k]}),e.jsxs("span",{className:"rounded-full bg-zinc-100 px-3 py-1 text-zinc-700",children:["History: ",C]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(d,{asChild:!0,variant:t==="active"?"default":"outline",className:t==="active"?"h-11 rounded-xl bg-[#212121] font-black hover:bg-[#000000]":"h-11 rounded-xl border-zinc-200 font-bold",children:e.jsx(p,{href:"/telegram/orders?scope=active",children:"Active Orders"})}),e.jsx(d,{asChild:!0,variant:t==="history"?"default":"outline",className:t==="history"?"h-11 rounded-xl bg-[#212121] font-black hover:bg-[#000000]":"h-11 rounded-xl border-zinc-200 font-bold",children:e.jsx(p,{href:"/telegram/orders?scope=history",children:"History"})})]})]}),n&&e.jsxs("div",{className:"rounded-3xl bg-white p-10 text-center shadow-sm ring-1 ring-zinc-100",children:[e.jsx(S,{className:"mx-auto size-8 animate-spin text-[#F57C00]"}),e.jsx("p",{className:"mt-4 text-sm font-medium text-[#757575]",children:"Loading orders..."})]}),!n&&i&&e.jsx("div",{className:"rounded-3xl border border-rose-200 bg-rose-50 p-6 text-sm font-bold text-rose-700",children:i}),!n&&!i&&m.length===0&&e.jsxs("div",{className:"rounded-3xl bg-white p-10 text-center shadow-sm ring-1 ring-zinc-100",children:[e.jsx(P,{className:"mx-auto size-8 text-zinc-300"}),e.jsx("p",{className:"mt-4 text-sm font-bold text-zinc-500",children:t==="history"?"No Telegram order history yet.":"No active Telegram orders."})]}),!n&&!i&&m.length>0&&e.jsx("div",{className:"space-y-4",children:m.map(r=>e.jsx("div",{className:"rounded-2xl bg-white p-5 shadow-sm ring-1 ring-zinc-100",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-black text-[#212121]",children:["Order #",r.id]}),e.jsx("span",{className:`rounded-full px-2.5 py-1 text-[10px] font-black uppercase tracking-wide ${B(r.order_status)}`,children:H(r.order_status)})]}),e.jsxs("p",{className:"text-xs font-medium text-[#757575]",children:["Pickup: ",r.pickup_date??"N/A"]}),e.jsxs("p",{className:"text-xs font-medium text-[#757575]",children:["Branch: ",r.pickup_location.name??"Unknown"]}),e.jsx("p",{className:"text-sm font-black text-[#F57C00]",children:M(r.total_amount)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.pickup_location.google_maps_url&&e.jsx(d,{asChild:!0,variant:"outline",className:"h-10 rounded-xl border-zinc-200",children:e.jsxs("a",{href:r.pickup_location.google_maps_url,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(L,{className:"size-4"}),e.jsx(D,{className:"size-3"})]})}),e.jsx(d,{asChild:!0,className:"h-10 rounded-xl bg-[#212121] font-black hover:bg-[#000000]",children:e.jsxs(p,{href:`/orders/${r.tracking_token}/track`,children:["Track",e.jsx(R,{className:"size-4"})]})})]})]})},r.id))})]})})]})}export{X as default};
