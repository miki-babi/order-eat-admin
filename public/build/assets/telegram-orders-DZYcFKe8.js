import{r as n,j as e,H as L,L as g}from"./app-CG6OGoCR.js";import{B as m}from"./createLucideIcon-DoozJVY3.js";import{R as O}from"./refresh-cw-LWD7K445.js";import{S as D}from"./shopping-bag-BHWhwzd2.js";import{L as P}from"./loader-circle-B3m9yfgN.js";import{P as R}from"./package-CDH_7ikH.js";import{M as H}from"./map-pin-CNW3to94.js";import{E as M}from"./external-link-D28LRgZS.js";import{A as B}from"./arrow-right-B-UX3SBx.js";/* empty css            */function v(){return typeof window>"u"?null:window.Telegram?.WebApp??null}function k(){if(typeof window>"u")return null;const t=u=>{const p=u.trim().replace(/^[?#]/,"");if(p==="")return null;const c=new URLSearchParams(p).get("tgWebAppData");if(typeof c!="string")return null;const o=c.trim();return o===""?null:o};return t(window.location.search)??t(window.location.hash)}function W(t){return t==="preparing"?"Preparing":t==="ready"?"Ready for Pickup":t==="completed"?"Completed":"Pending"}function $(t){return t==="completed"?"bg-emerald-100 text-emerald-700":t==="ready"?"bg-blue-100 text-blue-700":t==="preparing"?"bg-amber-100 text-amber-700":"bg-zinc-100 text-zinc-700"}function U(t){return new Intl.NumberFormat("en-ET",{style:"currency",currency:"ETB",maximumFractionDigits:2}).format(t)}function ee({scope:t}){const[u,p]=n.useState([]),[l,c]=n.useState(!0),[o,b]=n.useState(null),[z,C]=n.useState(0),[E,_]=n.useState(0),[T,A]=n.useState(0),[F,y]=n.useState(!1),j=n.useRef(0),w=t==="history"?"Telegram Order History":"Active Telegram Orders",S=n.useMemo(()=>t==="history"?"All orders you placed through Telegram.":"Orders currently pending, preparing, or ready for pickup.",[t]);return n.useEffect(()=>{if(typeof window>"u")return;let r=!1;const a=()=>{r||(r=!0,window.requestAnimationFrame(()=>{const s=window.scrollY||0;if(window.matchMedia("(min-width: 768px)").matches){y(!1),j.current=s,r=!1;return}const x=s-j.current,h=s>72;x>6&&h?y(!0):(x<-6||s<24)&&y(!1),j.current=s,r=!1}))};return window.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",a),a(),()=>{window.removeEventListener("scroll",a),window.removeEventListener("resize",a)}},[]),n.useEffect(()=>{let r=!1,a=null,s=null;const N=async d=>{c(!0),b(null),a=new AbortController;try{const f=await fetch("/api/telegram/miniapp/orders",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({init_data:d,scope:t}),signal:a.signal}),i=await f.json();if(!f.ok||!i.ok)throw new Error(i.error??"Unable to load Telegram orders.");if(r)return;p(Array.isArray(i.orders)?i.orders:[]),_(Number(i.meta?.active_orders_count??0)),A(Number(i.meta?.history_orders_count??0))}catch{r||(p([]),b("Could not load Telegram orders. Please open this page from the Telegram bot and try again."))}finally{r||c(!1)}},x=d=>{if(r)return;d?.ready?.(),d?.expand?.();const f=typeof d?.initData=="string"?d.initData.trim():"",i=f!==""?f:k()??"";if(i===""){c(!1),b("Telegram session data is missing. Open this from /track or /history in the bot.");return}N(i)},h=v();return h!==null||k()!==null?x(h):typeof document<"u"&&(s=document.createElement("script"),s.src="https://telegram.org/js/telegram-web-app.js",s.async=!0,s.onload=()=>{x(v())},document.head.appendChild(s)),()=>{r=!0,a?.abort(),s&&s.remove()}},[t,z]),e.jsxs(e.Fragment,{children:[e.jsx(L,{title:w}),e.jsx("div",{className:"min-h-screen bg-[#FAFAFA] text-[#212121]",children:e.jsxs("main",{className:"mx-auto w-full max-w-4xl px-4 py-8 md:px-8",children:[e.jsxs("div",{className:`sticky top-0 z-40 mb-6 rounded-3xl bg-white/95 p-6 shadow-lg ring-1 ring-zinc-100 backdrop-blur transition-all duration-300 md:relative md:top-0 md:mb-8 md:bg-white md:backdrop-blur-none md:translate-y-0 md:opacity-100 md:pointer-events-auto ${F?"-translate-y-[120%] opacity-0 pointer-events-none":"translate-y-0 opacity-100"}`,children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-[#9E9E9E]",children:"Telegram Miniapp"}),e.jsx("h1",{className:"mt-1 text-2xl font-black text-[#212121]",children:w}),e.jsx("p",{className:"mt-2 text-sm text-[#757575]",children:S})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{type:"button",variant:"outline",className:"h-10 rounded-xl border-zinc-200",onClick:()=>C(r=>r+1),disabled:l,children:[e.jsx(O,{className:`size-4 ${l?"animate-spin":""}`}),"Refresh"]}),e.jsx(m,{asChild:!0,className:"h-10 rounded-xl bg-[#F57C00] font-black hover:bg-[#E65100]",children:e.jsxs(g,{href:"/telegram/menu",children:[e.jsx(D,{className:"size-4"}),"Menu"]})})]})]}),e.jsxs("div",{className:"mt-5 flex flex-wrap items-center gap-3 text-xs font-bold text-[#616161]",children:[e.jsxs("span",{className:"rounded-full bg-[#FFF3E0] px-3 py-1 text-[#E65100]",children:["Active: ",E]}),e.jsxs("span",{className:"rounded-full bg-zinc-100 px-3 py-1 text-zinc-700",children:["History: ",T]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(m,{asChild:!0,variant:t==="active"?"default":"outline",className:t==="active"?"h-11 rounded-xl bg-[#212121] font-black hover:bg-[#000000]":"h-11 rounded-xl border-zinc-200 font-bold",children:e.jsx(g,{href:"/telegram/orders?scope=active",children:"Active Orders"})}),e.jsx(m,{asChild:!0,variant:t==="history"?"default":"outline",className:t==="history"?"h-11 rounded-xl bg-[#212121] font-black hover:bg-[#000000]":"h-11 rounded-xl border-zinc-200 font-bold",children:e.jsx(g,{href:"/telegram/orders?scope=history",children:"History"})})]})]}),l&&e.jsxs("div",{className:"rounded-3xl bg-white p-10 text-center shadow-sm ring-1 ring-zinc-100",children:[e.jsx(P,{className:"mx-auto size-8 animate-spin text-[#F57C00]"}),e.jsx("p",{className:"mt-4 text-sm font-medium text-[#757575]",children:"Loading orders..."})]}),!l&&o&&e.jsx("div",{className:"rounded-3xl border border-rose-200 bg-rose-50 p-6 text-sm font-bold text-rose-700",children:o}),!l&&!o&&u.length===0&&e.jsxs("div",{className:"rounded-3xl bg-white p-10 text-center shadow-sm ring-1 ring-zinc-100",children:[e.jsx(R,{className:"mx-auto size-8 text-zinc-300"}),e.jsx("p",{className:"mt-4 text-sm font-bold text-zinc-500",children:t==="history"?"No Telegram order history yet.":"No active Telegram orders."})]}),!l&&!o&&u.length>0&&e.jsx("div",{className:"space-y-4",children:u.map(r=>e.jsx("div",{className:"rounded-2xl bg-white p-5 shadow-sm ring-1 ring-zinc-100",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-black text-[#212121]",children:["Order #",r.id]}),e.jsx("span",{className:`rounded-full px-2.5 py-1 text-[10px] font-black uppercase tracking-wide ${$(r.order_status)}`,children:W(r.order_status)})]}),e.jsxs("p",{className:"text-xs font-medium text-[#757575]",children:["Pickup: ",r.pickup_date??"N/A"]}),e.jsxs("p",{className:"text-xs font-medium text-[#757575]",children:["Branch: ",r.pickup_location.name??"Unknown"]}),e.jsx("p",{className:"text-sm font-black text-[#F57C00]",children:U(r.total_amount)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.pickup_location.google_maps_url&&e.jsx(m,{asChild:!0,variant:"outline",className:"h-10 rounded-xl border-zinc-200",children:e.jsxs("a",{href:r.pickup_location.google_maps_url,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(H,{className:"size-4"}),e.jsx(M,{className:"size-3"})]})}),e.jsx(m,{asChild:!0,className:"h-10 rounded-xl bg-[#212121] font-black hover:bg-[#000000]",children:e.jsxs(g,{href:`/orders/${r.tracking_token}/track`,children:["Track",e.jsx(B,{className:"size-4"})]})})]})]})},r.id))})]})})]})}export{ee as default};
